#!/usr/bin/env python

import os
import re
import sys

from ripe.atlas.tools.exceptions import RipeAtlasToolsException
from ripe.atlas.tools.commands import get_available_commands


def main():

    caller = os.path.basename(__file__)

    args = []
    kwargs = {}

    shortcut = re.match('^a(ping|traceroute|dig|ssl|ntp|http)$', caller)

    if shortcut:
        command = "create"
        kwargs["type"] = shortcut.group(1)
    else:
        available_commands = get_available_commands()
        if len(sys.argv) < 2:
            raise RipeAtlasToolsException(
                "Usage: ripe-atlas <{}> [arguments]".format(
                    "|".join(available_commands)
                )
            )
        command = sys.argv.pop(1)

    try:

        __import__(
            "ripe.atlas.tools.commands." + command,
            globals(),
            locals(),
            [command]
        ).Command(*args, **kwargs).run()

    except ImportError:
        raise RipeAtlasToolsException("No such command.")

if __name__ == '__main__':
    try:
        sys.exit(main())
    except RipeAtlasToolsException as e:
        e.write()
